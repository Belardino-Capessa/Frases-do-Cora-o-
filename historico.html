<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Histórico de Frases</title>
    
    <link href="assets/fontawesome/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/estilo-global.css">

<script src="assets/js/config-global.js"></script>
    
    <script>
        // --------------------------------
        // VARIÁVEIS DE CONFIGURAÇÃO E DADOS
        // --------------------------------
        const themeKey = 'appTheme';
        const corKey = 'appCorDestaque';
        const fundoKey = 'appCorFundo';
        const corTextoKey = 'appCorTexto';
        const corPadrao = '#e91e63'; 
        const fundoPadrao = '#eef2f5'; 
        const corTextoPadrao = '#1c274b'; 
        
        // Chaves de Feedback e Armazenamento (KEY_FAVORITOS é necessária para checar o status)
        const KEY_VIBRACAO = 'prefVibracao';
        const KEY_SOM = 'prefSomClique';
        const KEY_FAVORITOS = 'frasesFavoritas';
        const KEY_HISTORICO = 'frasesHistorico'; // CHAVE DO HISTÓRICO
        
        /**
         * Aplica as configurações de tema e cor salvas no localStorage.
         */
        function loadSettings() {
            const savedTheme = localStorage.getItem(themeKey);
            const savedDestaque = localStorage.getItem(corKey);
            const savedFundo = localStorage.getItem(fundoKey);
            const savedTexto = localStorage.getItem(corTextoKey);
            
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            let isDarkMode = (savedTheme === 'dark') || (!savedTheme && prefersDark);
            
            if (document.body) {
                if (isDarkMode) {
                    document.body.classList.add('theme-escuro');
                } else {
                    document.body.classList.remove('theme-escuro');
                }
            }
            
            const finalFundo = savedFundo || (isDarkMode ? '#121212' : fundoPadrao);
            const finalTexto = savedTexto || (isDarkMode ? '#f0f0f0' : corTextoPadrao);

            document.documentElement.style.setProperty('--cor-destaque', savedDestaque || corPadrao);
            document.documentElement.style.setProperty('--cor-fundo-principal', finalFundo);
            document.documentElement.style.setProperty('--cor-texto-principal', finalTexto);
        }
        
        loadSettings();
    </script>
    
    <script>
    (function() {
        // Busca a preferência salva (padrão 100% se não existir)
        const fonteSalva = localStorage.getItem('appFontePerc') || '100';
        
        // Calcula o valor em pixels (16px * percentagem)
        const tamanhoCalculado = (fonteSalva / 100) * 16;
        
        // Aplica imediatamente ao root antes da página renderizar (evita o "pulo" visual)
        document.documentElement.style.setProperty('--fonte-base', tamanhoCalculado + 'px');
    })();
</script>

    <style>
        /* ESTILOS CSS REPETIDOS */
        
        /* FONTE */
        @font-face {
            font-family: 'Nunito';
            src: url('../assets/fontes/Nunito-VariableFont_wght.ttf') format('truetype');
            font-weight: 100 900;
        }

        /* -------------------------------- */
        /* 0. VARIÁVEIS E TEMAS (Glassmorphism Base) */
        /* -------------------------------- */
        :root {
            --cor-fundo-principal: #eef2f5; --cor-texto-principal: #1c274b; --cor-card-fundo: #ffffff; --cor-destaque: #e91e63;
            --cor-sombra: rgba(28, 39, 75, 0.15); --cor-glass-fundo: rgba(255, 255, 255, 0.25); --cor-glass-borda: rgba(255, 255, 255, 0.7);
            --cor-particula-1: var(--cor-destaque); --cor-particula-2: var(--cor-texto-principal); --fonte-base: 16px; --borda-raio: 1.5rem; --duracao-animacao: 0.5s;
        }
        .theme-escuro {
            --cor-fundo-principal: #121212; --cor-texto-principal: #f0f0f0; --cor-card-fundo: #1e1e1e; --cor-sombra: rgba(0, 0, 0, 0.5);
            --cor-glass-fundo: rgba(255, 255, 255, 0.05); --cor-glass-borda: rgba(255, 255, 255, 0.15); --cor-particula-1: var(--cor-destaque); 
            --cor-particula-2: var(--cor-texto-principal); 
        }

        /* Reset Básico e Body */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { font-size: var(--fonte-base); }
        body {
            font-family: 'Nunito', sans-serif; background-color: var(--cor-fundo-principal); color: var(--cor-texto-principal);
            min-height: 100vh; transition: background-color var(--duracao-animacao), color var(--duracao-animacao);
            padding-top: 5rem; padding-bottom: 3rem; 
        }
        .container { width: 100%; max-width: 100%; margin: 0 auto; padding: 1.5rem; position: relative; z-index: 10; }

        /* Fundo Animado */
        .fundo-animado { position: fixed; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; z-index: -1; }
        .fundo-animado::before, .fundo-animado::after { content: ''; position: absolute; width: 15rem; height: 15rem; border-radius: 50%; opacity: 0.3; animation: flutuar 20s infinite ease-in-out; pointer-events: none; }
        .fundo-animado::before { background-color: var(--cor-particula-1); top: 10vh; left: 5vw; }
        .fundo-animado::after { background-color: var(--cor-particula-2); bottom: 15vh; right: 5vw; animation-delay: -10s; }
        @keyframes flutuar { 0%, 100% { transform: translate(0, 0) scale(1); } 50% { transform: translate(15vw, 15vh) scale(1.1); } }

        /* Cabeçalho */
        .cabecalho-principal {
            display: flex; align-items: center; justify-content: space-between; position: fixed; top: 0; left: 50%; transform: translateX(-50%); 
            width: 100%; max-width: 95%; padding: 1rem 1.5rem; background-color: var(--cor-fundo-principal); 
            box-shadow: 0 2px 10px var(--cor-sombra); z-index: 50;
            border-radius: 1.5rem;
            margin-top: 1rem;
        }
        .cabecalho-principal h1 { font-size: 1.75rem; color: var(--cor-destaque); font-weight: 800; position: absolute; left: 50%; transform: translateX(-50%); }
        .btn-voltar { background: none; border: none; color: var(--cor-destaque); font-size: 1.5rem; cursor: pointer; padding: 0.5rem; border-radius: 50%; transition: all 0.2s; }

        /* Ripple Effect */
        .ripple {position: relative;overflow: hidden;}
        .ripple-effect {position: absolute;border-radius: 50%;transform: scale(0);animation: ripple-anim 0.6s linear;background-color: rgba(255, 255, 255, 0.7);pointer-events: none;}
        .theme-escuro .ripple-effect {background-color: rgba(255, 255, 255, 0.1);}
        @keyframes ripple-anim {to {transform: scale(4);opacity: 0;}}
        
        /* -------------------------------- */
        /* ESTILOS ESPECÍFICOS DE CONTEÚDO */
        /* -------------------------------- */
        
        /* LISTA DE FRASES */
        .frases-lista {
            display: flex; flex-direction: column; gap: 1.5rem; padding-top: 1rem;
        }
        
        .frase-card {
            background: var(--cor-glass-fundo); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); 
            border: 1px solid var(--cor-glass-borda); box-shadow: 0 0.5rem 2rem 0 rgba(31, 38, 135, 0.1);
            padding: 1.5rem; border-radius: var(--borda-raio);
        }

        .frase-texto { font-size: 1.25rem; font-style: italic; margin-bottom: 0.75rem; margin-top: 1.5rem; marinline-height: 1.5; }
        .frase-autor {
            display: block; text-align: right; font-size: 0.9rem; font-weight: 600;
            color: var(--cor-texto-principal); opacity: 0.7; padding-bottom: 1rem; border-bottom: 1px dashed var(--cor-glass-borda);
        }

        .frase-acoes { display: flex; justify-content: space-around; padding-top: 1rem; }
        .btn-acao { background: none; border: none; color: var(--cor-texto-principal); cursor: pointer; font-size: 1.5rem; padding: 0.5rem; border-radius: 50%; transition: color 0.2s; }
        .btn-acao:hover { color: var(--cor-destaque); }
        .btn-favoritar.favoritado { color: var(--cor-destaque); }
        
        #status-message { text-align: center; padding: 40px 0; font-size: 1.1rem; color: var(--cor-texto-principal); opacity: 0.7; }
        
        /* ================== Geral e Reset ================== */
        
        .frase-categoria {
                position: absolute;
        top: 15px;      /* Ajuste conforme seu gosto */
        left: 15px;    /* Ajuste conforme seu gosto */
        z-index: 99;    /* Garante que fique acima de tudo */
        display: flex;
        pointer-events: none; /* Evita que o clique no badge atrapalhe o link */
        transform: none !important; 
        background: rgba(var(--cor-destaque-rgb, 233, 30, 99), 0.1);
        color: var(--cor-texto-principal);
        font-size: 1rem;
        font-weight: 800;
        min-width: 22px;
        height: 22px;
        padding: 0 5px;
        border-radius: var(--borda-raio);
        align-items: center;
        justify-content: center;
        border: 1px solid rgba(var(--cor-destaque-rgb, 233, 30, 99), 0.2);
        transition: transform 0.3s ease;
            }

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Nunito', sans-serif;
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -khtml-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

:focus, :active, a:focus, a:active, button:focus, button:active, input:focus, input:active, select:focus, select:active, textarea:focus, textarea:active {
    outline: none;
    -webkit-tap-highlight-color: transparent;
}

    .fas ,fa{
    animation: pulse 3s infinite;
}
    
        /* --- EFEITOS / ANIMAÇÕES --- */
    .fade-out { animation:fadeOut 0.5s ease-in-out forwards; }
    @keyframes fadeIn { from{opacity:0;transform:scale(0.9);} to{opacity:1;transform:scale(1);} }
    @keyframes fadeOut { from{opacity:1;} to{opacity:0;visibility:hidden;} }
    @keyframes pulse { 0%,100%{transform:scale(1);} 50%{transform:scale(1.2);} }
    @keyframes bounce { 0%,80%,100%{transform:scale(0.8);} 40%{transform:scale(1.2);} }
}
/* TOOLBAR DE HISTÓRICO - ESTILO GLASS */
.historico-toolbar {
    background: var(--cor-glass-fundo);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid var(--cor-glass-borda);
    border-radius: var(--borda-raio);
    padding: 1rem;
    margin-bottom: 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    box-shadow: 0 0.5rem 2rem 0 rgba(0, 0, 0, 0.1);
}

.busca-container {
    display: flex;
    align-items: center;
    background: var(--cor-card-fundo);
    padding: 0.75rem 1rem;
    border-radius: var(--borda-raio);
    box-shadow: var(--sombra-padrao);
    transition: box-shadow 0.3s;
    margin-bottom: 0.5rem;
    
        /* Glassmorphism Efeito */
    background: var(--cor-glass-fundo);
    box-shadow: 0 0.5rem 2rem 0 rgba(31, 38, 135, 0.2);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    border-radius: var(--borda-raio);
    border: 1px solid var(--cor-glass-borda);
}

.busca-container:focus-within {
    box-shadow: 0 0 0 1px var(--cor-destaque);
}

.input-estilizado {
    border: none;
    outline: none;
    flex-grow: 1;
    padding: 0 0.75rem;
    font-size: 1rem;
    background: transparent;
    color: var(--cor-texto-principal);
}

.icon-busca {
    opacity: 1;
    color: var(--cor-destaque);
}


.input-estilizado:focus {
    border-color: var(--cor-destaque);
}

.controles-linha {
    display: flex;
    gap: 10px;
}

.select-estilizado {
    flex: 1;
    border: 1px solid var(--cor-glass-borda);
    color: var(--cor-texto-principal);
    cursor: pointer;
    align-items: center;
    padding: 0.75rem 1rem;
    border-radius: var(--borda-raio);
    box-shadow: var(--sombra-padrao);
    transition: box-shadow 0.3s;
    margin-bottom: 0.5rem;
    
        /* Glassmorphism Efeito */
    background: var(--cor-glass-fundo);
    box-shadow: 0 0.5rem 2rem 0 rgba(31, 38, 135, 0.2);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    border-radius: var(--borda-raio);
}

.btn-limpar-tudo {
     background: rgba(var(--cor-destaque-rgb, 233, 30, 99), 0.1); !important;
    color: var(--cor-texto-principal) !important;
    border: 1px solid var(--cor-glass-borda);
    border-radius: var(--borda-raio);
    padding: 0 1.2rem;
    font-weight: 600;
    cursor: pointer;
}

    </style>
</head>

<body> 
    <div class="fundo-animado"></div>

    <header class="cabecalho-principal">
        <button onclick="window.location.href = 'index.html'" class="btn-voltar ripple" aria-label="Voltar para Início">
            <i class="fas fa-arrow-left"></i>
        </button>
        <h1 id="header-titulo"><i class="fas fa-history"></i>Histórico</h1>
        <div style="width: 2.5rem; visibility: hidden;"></div> 
    </header>

   <div class="container">
    <div class="historico-toolbar">
        <div class="busca-container">
            <i class="fas fa-search icon-busca"></i>
            <input type="text" id="input-busca" class="input-estilizado" placeholder="Procurar frase...">
        </div>
        
        <div class="controles-linha">
            <select id="filtro-categoria" class="select-estilizado">
                <option value="todos">Todas Categorias</option>
            </select>
            
            <button id="btn-limpar-historico" class="btn-limpar-tudo ripple">
                <i class="fas fa-broom"></i>
            </button>
        </div>
    </div>

    <section id="historico-lista" class="frases-lista">
        <p id="status-message">Carregando seu histórico...</p>
    </section>
</div>
    <script>


    // --- ELEMENTOS DOM ---
    const dom = {
        listaFrases: document.getElementById('historico-lista'),
        btnVoltar: document.querySelector('.btn-voltar'),
        inputBusca: document.getElementById('input-busca'),
        filtroCat: document.getElementById('filtro-categoria'),
        btnLimpar: document.getElementById('btn-limpar-historico')
    };
    
    // --------------------------------
    // FUNÇÕES DE GERENCIAMENTO DE DADOS
    // --------------------------------

    function getSavedItems(key) {
        try {
            const json = localStorage.getItem(key);
            return json ? JSON.parse(json) : [];
        } catch (e) {
            console.error(`Erro ao carregar dados de ${key}:`, e);
            return [];
        }
    }

    function saveItems(key, items) {
        try {
            localStorage.setItem(key, JSON.stringify(items));
        } catch (e) {
            console.error(`Erro ao salvar dados em ${key}:`, e);
        }
    }

    // --------------------------------
    // LÓGICA DE ID E FAVORITOS
    // --------------------------------
    
    function getFraseId(frase) {
        if (!frase || !frase.texto) return null;
        const autorNormalizado = (frase.autor && frase.autor.trim()) || 'Anônimo';
        // Geramos um ID único baseado no conteúdo para evitar erros de index
        return btoa(unescape(encodeURIComponent(frase.texto + autorNormalizado))).substring(0, 32);
    }

    function isFavorited(frase) {
        const favoritos = getSavedItems(KEY_FAVORITOS);
        const idParaBuscar = getFraseId(frase); 
        if (!idParaBuscar) return false;
        return favoritos.some(item => getFraseId(item) === idParaBuscar);
    }

    function toggleFavorite(frase) {
        if (!frase || !frase.texto) return false;
        let favoritos = getSavedItems(KEY_FAVORITOS);
        const idParaBuscar = getFraseId(frase);
        if (!idParaBuscar) return false;
        const indiceExistente = favoritos.findIndex(item => getFraseId(item) === idParaBuscar);

        if (indiceExistente !== -1) {
            favoritos.splice(indiceExistente, 1);
            saveItems(KEY_FAVORITOS, favoritos);
            return false;
        } else {
            favoritos.push({ ...frase, id: idParaBuscar });
            saveItems(KEY_FAVORITOS, favoritos);
            return true;
        }
    }

    // --------------------------------
    // FUNÇÕES DE FEEDBACK E UI
    // --------------------------------

    function playClickSound() {
        if (localStorage.getItem('prefSomClique') !== 'false') {
            const audio = new Audio('assets/sound/click.mp3');
            audio.volume = 0.3;
            audio.play().catch(() => {});
        }
    }

    function triggerHapticFeedback(pattern = 20) {
        if (navigator.vibrate && localStorage.getItem('pref-vibracao') !== 'false') {
            navigator.vibrate(pattern);
        }
    }

    function applyRippleEffect(e) {
        const target = e.currentTarget;
        triggerHapticFeedback(20);
        playClickSound();

        const rect = target.getBoundingClientRect();
        const oldRipple = target.querySelector('.ripple-effect');
        if (oldRipple) oldRipple.remove();

        const size = Math.max(rect.width, rect.height);
        const x = (e.clientX || (e.touches && e.touches[0].clientX)) - rect.left - size / 2;
        const y = (e.clientY || (e.touches && e.touches[0].clientY)) - rect.top - size / 2;
        
        const newRipple = document.createElement('span');
        newRipple.classList.add('ripple-effect');
        newRipple.style.width = newRipple.style.height = size + 'px';
        newRipple.style.left = x + 'px';
        newRipple.style.top = y + 'px';
        
        target.appendChild(newRipple);
        newRipple.addEventListener('animationend', () => newRipple.remove());
    }

    function applySavedTheme() {
        const savedTheme = localStorage.getItem(themeKey);
        if (savedTheme === 'dark') document.body.classList.add('theme-escuro');
        
        const vars = [
            {key: corKey, prop: '--cor-destaque'},
            {key: fundoKey, prop: '--cor-fundo-principal'},
            {key: corTextoKey, prop: '--cor-texto-principal'}
        ];
        
        vars.forEach(v => {
            const val = localStorage.getItem(v.key);
            if (val) document.documentElement.style.setProperty(v.prop, val);
        });
    }

    // --------------------------------
    // NOVAS FUNÇÕES: BUSCA, FILTRO E EDIÇÃO
    // --------------------------------

    function handleEditarNoCanvas(texto, autor) {
        try {
            const dadosParaEdicao = { textoFrase: texto, textoAutor: autor || "Anônimo" };
            localStorage.setItem('dados_edicao_simples', JSON.stringify(dadosParaEdicao));
            triggerHapticFeedback(40);
            window.location.href = 'frases-imagem.html'; 
        } catch (e) { console.error(e); }
    }

    function renderHistorico() {
        const historicoRaw = getSavedItems(KEY_HISTORICO);
        const historico = [...historicoRaw].reverse(); 
        
        dom.listaFrases.innerHTML = ''; 

        const msg = document.createElement('p');
        msg.id = 'status-message';
        msg.style.cssText = "text-align: center; padding: 40px 0; font-size: 1.1rem; color: var(--cor-texto-principal); opacity: 0.7; display: none;";
        dom.listaFrases.appendChild(msg);

        if (historico.length === 0) {
            msg.textContent = "Seu histórico está vazio.";
            msg.style.display = 'block';
            if(dom.filtroCat) dom.filtroCat.innerHTML = '<option value="todos">Todas Categorias</option>';
            return;
        }

        atualizarCategoriasNoSelect(historico);

        historico.forEach((item, index) => {
            dom.listaFrases.appendChild(renderFraseCard(item, index));
        });
        
        filtrarHistorico();
    }

    function filtrarHistorico() {
        const termo = dom.inputBusca ? dom.inputBusca.value.toLowerCase() : "";
        const categoria = dom.filtroCat ? dom.filtroCat.value : "todos";
        const cards = dom.listaFrases.querySelectorAll('.frase-card');
        const msgVazio = document.getElementById('status-message');
        
        let encontrados = 0;
        cards.forEach(card => {
            const texto = card.querySelector('.frase-texto').innerText.toLowerCase();
            const catCard = card.querySelector('.frase-categoria').innerText;
            const bateBusca = texto.includes(termo);
            const bateCategoria = (categoria === 'todos' || catCard === categoria);

            if (bateBusca && bateCategoria) {
                card.style.display = 'block';
                encontrados++;
            } else {
                card.style.display = 'none';
            }
        });

        if (msgVazio) {
            msgVazio.style.display = (encontrados === 0 && cards.length > 0) ? 'block' : 'none';
            if (encontrados === 0 && cards.length > 0) msgVazio.textContent = "Nenhum resultado.";
        }
    }

    function handleLimparHistoricoTotal() {
        window.CustomModal.show({
            titulo: "Limpar Histórico",
            mensagem: "Deseja apagar TODO o seu histórico?",
            tipo: "confirm",
            icone: "fa-broom",
            aoConfirmar: () => {
                saveItems(KEY_HISTORICO, []);
                renderHistorico();
            }
        });
    }

    function atualizarCategoriasNoSelect(historico) {
        if(!dom.filtroCat) return;
        const categorias = [...new Set(historico.map(item => item.categoria))];
        dom.filtroCat.innerHTML = '<option value="todos">Todas Categorias</option>';
        categorias.forEach(cat => {
            const opt = document.createElement('option');
            opt.value = cat; opt.innerText = cat;
            dom.filtroCat.appendChild(opt);
        });
    }

    // --------------------------------
    // AÇÕES DO CARD
    // --------------------------------

    function handleCopiar(texto, event) {
        const button = event.currentTarget;
        const textoReal = decodeURIComponent(texto);
        navigator.clipboard.writeText(textoReal).then(() => {
            const icon = button.querySelector('i');
            icon.className = 'fas fa-check';
            triggerHapticFeedback(75);
            setTimeout(() => { icon.className = 'fas fa-copy'; }, 1000);
        });
    }

    function handleFavoritarHistorico(fraseJson, event) {
        const button = event.currentTarget;
        const frase = JSON.parse(decodeURIComponent(fraseJson));
        const favoritado = toggleFavorite(frase);
        const icone = button.querySelector('i');
        button.classList.toggle('favoritado', favoritado);
        icone.className = favoritado ? 'fas fa-heart' : 'far fa-heart';
        triggerHapticFeedback(30);
    }

    // --- FUNÇÃO DE APAGAR DEFINITIVA ---
    window.prepararApagar = function(idAlvo, event) {
        if (event) event.stopPropagation();
        
        window.CustomModal.show({
            titulo: "Remover Frase",
            mensagem: "Deseja remover este item do seu histórico?",
            tipo: "confirm",
            icone: "fa-trash-alt",
            aoConfirmar: () => {
                let historico = getSavedItems(KEY_HISTORICO);
                // Filtra removendo o item que gera o mesmo ID
                const novoHistorico = historico.filter(f => getFraseId(f) !== idAlvo);
                saveItems(KEY_HISTORICO, novoHistorico);
                
                const card = event.target.closest('.frase-card');
                if (card) {
                    card.style.opacity = '0';
                    card.style.transform = 'scale(0.9)';
                    setTimeout(renderHistorico, 300);
                } else {
                    renderHistorico();
                }
            }
        });
    };

    function renderFraseCard(frase, index) {
        const card = document.createElement('div');
        card.className = 'frase-card';
        
        const idUnico = getFraseId(frase);
        const txtExibicao = frase.texto.replace(/"/g, '&quot;');
        const autorExibicao = (frase.autor || 'Anônimo').replace(/"/g, '&quot;');
        const catExibicao = (frase.categoria || 'Geral').replace(/"/g, '&quot;');

        const txtJS = encodeURIComponent(frase.texto).replace(/'/g, "%27");
        const autorJS = encodeURIComponent(frase.autor || 'Anônimo').replace(/'/g, "%27");
        const fraseJson = encodeURIComponent(JSON.stringify(frase));

        card.innerHTML = `
            <h3 class="frase-categoria">${catExibicao}</h3>
            <p class="frase-texto">${txtExibicao}</p>
            <span class="frase-autor">— ${autorExibicao}</span>
            
            <div class="frase-acoes">
                <button class="btn-acao ripple" onclick="handleEditarNoCanvas(decodeURIComponent('${txtJS}'), decodeURIComponent('${autorJS}'))">
                    <i class="fas fa-image"></i>
                </button>
                <button class="btn-acao ripple" onclick="handleCopiar('${txtJS}', event)">
                    <i class="fas fa-copy"></i>
                </button>
                <button class="btn-acao btn-favoritar ripple ${isFavorited(frase) ? 'favoritado' : ''}" 
                    onclick="handleFavoritarHistorico('${fraseJson}', event)">
                    <i class="${isFavorited(frase) ? 'fas' : 'far'} fa-heart"></i>
                </button>
                <button class="btn-acao ripple" onclick="window.prepararApagar('${idUnico}', event)">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </div>
        `;
        
        card.querySelectorAll('.ripple').forEach(btn => {
            btn.addEventListener('mousedown', applyRippleEffect);
            btn.addEventListener('touchstart', applyRippleEffect, {passive: true});
        });
        return card;
    }

    // --------------------------------
    // INICIALIZAÇÃO
    // --------------------------------
    
    document.addEventListener('DOMContentLoaded', () => {
        applySavedTheme(); 

        if (dom.inputBusca) dom.inputBusca.oninput = filtrarHistorico;
        if (dom.filtroCat) dom.filtroCat.onchange = filtrarHistorico;
        if (dom.btnLimpar) dom.btnLimpar.onclick = handleLimparHistoricoTotal;

        if (dom.btnVoltar) {
            dom.btnVoltar.addEventListener('click', () => window.history.back());
        }
        
        renderHistorico(); 
    });
</script>

      
    </body>
    </html>