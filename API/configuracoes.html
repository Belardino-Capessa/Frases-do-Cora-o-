<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frases do Coração - Configurações</title>
    <link href="assets/fontawesome/css/all.min.css" rel="stylesheet">
    
      <link rel="stylesheet" href="assets/css/estilo-global.css">

<script src="assets/js/config-global.js"></script>
    
    
    <script>
        const themeKey = 'appTheme';
        const corKey = 'appCorDestaque';
        const fundoKey = 'appCorFundo';
        const corTextoKey = 'appCorTexto';
        const corPadrao = '#e91e63'; 
        const fundoPadrao = '#eef2f5'; 
        const corTextoPadrao = '#1c274b'; 

        // NOVO: Chave das Frases Criadas pelo Usuário
        const KEY_CITATIONS = 'minhasCitacoes'; 
        // Chaves de Configurações de Feedback
        const KEY_VIBRACAO = 'prefVibracao';
        const KEY_SOM = 'prefSomClique';

        function loadSettings() {
            const savedTheme = localStorage.getItem(themeKey);
            const savedDestaque = localStorage.getItem(corKey);
            const savedFundo = localStorage.getItem(fundoKey);
            const savedTexto = localStorage.getItem(corTextoKey);
            
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            let isDarkMode = (savedTheme === 'dark') || (!savedTheme && prefersDark);
            
            if (document.body) {
                if (isDarkMode) {
                    document.body.classList.add('theme-escuro');
                } else {
                    document.body.classList.remove('theme-escuro');
                }
            }
            
            // Aplica as cores salvas ou defaults do tema
            const finalFundo = savedFundo || (isDarkMode ? '#121212' : fundoPadrao);
            const finalTexto = savedTexto || (isDarkMode ? '#f0f0f0' : corTextoPadrao);

            document.documentElement.style.setProperty('--cor-destaque', savedDestaque || corPadrao);
            document.documentElement.style.setProperty('--cor-fundo-principal', finalFundo);
            document.documentElement.style.setProperty('--cor-texto-principal', finalTexto);
        }
        
        loadSettings();
    </script>

    <style>
        @font-face {
            font-family: 'Nunito';
            src: url('../assets/fontes/Nunito-VariableFont_wght.ttf') format('truetype');
            font-weight: 100 900;
        }
/*
         * --------------------------------
         * 0. Variáveis, Reset e Responsividade
         * --------------------------------
         */
        
        :root {
            /* AJUSTE: Definição inicial da variável de fonte */
            --familia-fonte: 'Nunito', sans-serif;

            /* Base de Cores - Tema Claro */
            --cor-fundo-principal: #eef2f5;
            --cor-texto-principal: #1c274b; 
            --cor-card-fundo: #ffffff;
            --cor-destaque: #e91e63;
            --cor-sombra: rgba(28, 39, 75, 0.15);
            
            /* Cores Glassmorphism */
            --cor-glass-fundo: rgba(255, 255, 255, 0.25);
            --cor-glass-borda: rgba(255, 255, 255, 0.7);
            
            /* Cores de Partículas Animadas (Tema Claro) */
            --cor-particula-1: var(--cor-destaque);
            --cor-particula-2: var(--cor-texto-principal); 
            
            /* Medidas e Animações */
            --fonte-base: 16px;
            --borda-raio: 1.5rem;
            --duracao-animacao: 0.5s;
            --sombra-padrao: 0 0.5rem 1.5rem var(--cor-sombra);
        }
        
        /* 2. Em vez de usar *, liste os elementos de texto que devem mudar */
/* Isso garante que títulos, parágrafos, spans e botões mudem, mas deixa os ícones em paz */
h1, h2, h3, h4, h5, h6, p, span, button, input, textarea, label, a {
    font-family: var(--familia-fonte);
}

/* 3. Proteção específica para ícones - O "Font Awesome" precisa de prioridade */
.fas, .far, .fab, .fa, [class^="fa-"], [class*=" fa-"] {
    font-family: "Font Awesome 5 Free" !important; /* Verifique se sua versão é a 5 ou 6 */
    font-weight: 900; /* FontAwesome sólido exige peso 900 */
}

        /* Tema Escuro */
        .theme-escuro {
            --cor-fundo-principal: #121212;
            --cor-texto-principal: #f0f0f0;
            --cor-card-fundo: #1e1e1e;
            --cor-sombra: rgba(0, 0, 0, 0.5);
            
            /* Cores Glassmorphism */
            --cor-glass-fundo: rgba(255, 255, 255, 0.05);
            --cor-glass-borda: rgba(255, 255, 255, 0.15);
            
            /* Cores de Partículas Animadas (Tema Escuro) */
            --cor-particula-1: var(--cor-destaque); 
            --cor-particula-2: var(--cor-texto-principal); 
        }

        /* Reset Básico e Fonte */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            /* AJUSTE: Força todos os elementos (h1, h2, button) a usarem a variável */
            font-family: var(--familia-fonte);
        }

        html {
            font-size: var(--fonte-base);
        }

        body {
            /* AJUSTE: Body agora consome a variável de forma limpa */
            font-family: var(--familia-fonte);
            font-size: 1rem;
            background-color: var(--cor-fundo-principal);
            color: var(--cor-texto-principal);
            min-height: 100vh; 
            transition: background-color 0.5s, color 0.5s, font-family 0.3s;
            padding-top: 5rem;
            padding-bottom: 3rem; 
        }
        
        .container {
            width: 100%;
            max-width: 100%; 
            margin: 0 auto;
            padding: 1.5rem;
            position: relative; 
            z-index: 10;
        }

        /*
         * --------------------------------
         * 1. Fundo Animado (Partículas/Bolhas)
         * --------------------------------
         */
        .fundo-animado {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1; 
        }

        .fundo-animado::before, .fundo-animado::after {
            content: '';
            position: absolute;
            width: 15rem;
            height: 15rem;
            border-radius: 50%;
            opacity: 0.3;
            animation: flutuar 20s infinite ease-in-out;
            pointer-events: none;
        }

        .fundo-animado::before {
            background-color: var(--cor-particula-1); 
            top: 10vh;
            left: 5vw;
        }

        .fundo-animado::after {
            background-color: var(--cor-particula-2); 
            bottom: 15vh;
            right: 5vw;
            animation-delay: -10s;
        }

        @keyframes flutuar {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(15vw, 15vh) scale(1.1); }
        }
        /* FIM: Fundo Animado */

        /* --------------------------------
         * 2. Estilos Glassmorphism, Cabeçalho
         * --------------------------------
         */
        .cabecalho-personalizacao {
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 95%;
            padding: 1rem 1.5rem;
            background-color: var(--cor-fundo-principal);
            box-shadow: 0 2px 10px var(--cor-sombra); 
            z-index: 50;
            border-radius: 1.5rem;
            margin-top: 1rem;
        }

        .cabecalho-personalizacao h1 {
            font-size: 1.75rem;
            color: var(--cor-destaque);
            font-weight: 800;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }

        .btn-voltar {
            background: none;
            border: none;
            color: var(--cor-texto-principal);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            z-index: 51; 
            transition: all 0.2s;
            border-radius: 50%;
        }
        
        .secao-personalizacao {
            background: var(--cor-glass-fundo);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--cor-glass-borda);
            box-shadow: 0 0.5rem 2rem 0 rgba(31, 38, 135, 0.1);
            padding: 1.5rem;
            border-radius: var(--borda-raio);
            margin-bottom: 1.5rem;
        }

        .secao-personalizacao h2 {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--cor-destaque);
            margin-bottom: 0.75rem;
            font-size: 1.5rem;
            border-bottom: 1px solid var(--cor-glass-borda);
            padding-bottom: 0.75rem;
        }
        
        .secao-personalizacao p {
            font-size: 0.9rem;
            color: var(--cor-texto-secundaria);
            margin-bottom: 1rem;
        }

        /* --------------------------------
         * Estilos do Switch/Toggle
         * --------------------------------
         */
        .switch-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 0;
            margin-top: 1rem;
            gap: 1rem;
        }
        
        .switch-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .switch-label i {
            color: var(--cor-destaque);
        }

        /* Estilos do SWITCH (Botão) */
        .switch {position: relative;display: inline-block;width: 60px;height: 34px;}
        .switch input {opacity: 0;width: 0;height: 0;}
        .slider {position: absolute;cursor: pointer;top: 0;left: 0;right: 0;bottom: 0;background-color: #ccc;transition: 0.4s;border-radius: 34px;}
        .slider:before {position: absolute;content: "";height: 26px;width: 26px;left: 4px;bottom: 4px;background-color: white;transition: 0.4s;border-radius: 50%;}
        input:checked + .slider {background-color: var(--cor-destaque);}
        input:checked + .slider:before {transform: translateX(26px);}

        /* --------------------------------
         * Estilos do Botão de Restauração (NOVO)
         * --------------------------------
         */
        .btn-restaurar-padroes {
            display: block;
            width: 100%;
            padding: 1rem;
            /* Cor vermelha para indicar ação destrutiva */
            background-color: var(--cor-destaque); 
            color: white;
            border: none;
            border-radius: 1rem;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
            margin-top: 1.5rem;
        }

        .btn-restaurar-padroes:active {
            transform: scale(0.98);
            background-color: var(--cor-glass-borda);
        }
        
        /* --------------------------------
         * Ripple Effect
         * --------------------------------
         */
        .ripple {position: relative;overflow: hidden;}
        .ripple-effect {position: absolute;border-radius: 50%;transform: scale(0);animation: ripple-anim 0.6s linear;background-color: rgba(255, 255, 255, 0.7);pointer-events: none;}
        .theme-escuro .ripple-effect {background-color: rgba(255, 255, 255, 0.1);}
        @keyframes ripple-anim {to {transform: scale(4);opacity: 0;}}
        
        /* ================== Geral e Reset ================== */

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Nunito', sans-serif;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        :focus, :active, a:focus, a:active, button:focus, button:active, input:focus, input:active, select:focus, select:active, textarea:focus, textarea:active {
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }

        .fas ,fa{
            animation: pulse 3s infinite;
            color: var(--cor-destaque);
        }
        
        /* --- EFEITOS / ANIMAÇÕES --- */
        .fade-out { animation:fadeOut 0.5s ease-in-out forwards; }
        @keyframes fadeIn { from{opacity:0;transform:scale(0.9);} to{opacity:1;transform:scale(1);} }
        @keyframes fadeOut { from{opacity:1;} to{opacity:0;visibility:hidden;} }
        @keyframes pulse { 0%,100%{transform:scale(1);} 50%{transform:scale(1.2);} }
        @keyframes bounce { 0%,80%,100%{transform:scale(0.8);} 40%{transform:scale(1.2);} }

/* NOVOS ESTILOS: Seletor de Opções e Slider */
.seletor-opcoes { display: flex; gap: 0.5rem; margin-top: 1rem; }

.opt-btn { 
    flex: 1; padding: 0.8rem; border: 1px solid var(--cor-glass-borda); 
    background: var(--cor-glass-fundo); color: var(--cor-texto-principal); 
    border-radius: 0.8rem; cursor: pointer; font-weight: bold; transition: 0.3s; 
}

.opt-btn.active { background-color: var(--cor-destaque); color: white; border-color: var(--cor-destaque); }

.slider-range { 
    -webkit-appearance: none; width: 100%; height: 8px; 
    border-radius: 5px; background: var(--cor-glass-borda); outline: none; 
}

.slider-range::-webkit-slider-thumb { 
    -webkit-appearance: none; width: 25px; height: 25px; 
    border-radius: 50%; background: var(--cor-destaque); cursor: pointer; 
}
    </style>
</head>

<body>
    <div class="fundo-animado"></div>

    <header class="cabecalho-personalizacao">
        <a href="index.html" class="btn-voltar ripple" aria-label="Voltar para a tela principal">
            <i class="fas fa-arrow-left"></i>
        </a>
        <h1><i class="fas fa-cog"></i>Configurações</h1>
        <div style="width: 2.5rem; visibility: hidden;"></div> 
    </header>

    <div class="container">
        
        <div class="secao-personalizacao">
            <h2><i class="fas fa-volume-up"></i> Controles de Feedback</h2>
            
            <div class="switch-container">
                <label class="switch-label" for="toggle-vibracao"><i class="fas fa-mobile-alt"></i> Feedback Tátil (Vibração)</label>
                <label class="switch">
                    <input type="checkbox" id="toggle-vibracao">
                    <span class="slider"></span>
                </label>
            </div>
            <p style="margin-top: 0.5rem; margin-left: 2rem; font-size: 0.85rem;">Ativa a vibração do dispositivo em cliques e interações.</p>


            <div class="switch-container" style="border-top: 1px solid var(--cor-glass-borda); padding-top: 1.5rem;">
                <label class="switch-label" for="toggle-som"><i class="fas fa-hand-point-up"></i> Som de Clique</label>
                <label class="switch">
                    <input type="checkbox" id="toggle-som">
                    <span class="slider"></span>
                </label>
            </div>
            <p style="margin-top: 0.5rem; margin-left: 2rem; font-size: 0.85rem;">Reproduz um som suave ao interagir com botões.</p>
            
        </div>
        
      
      <div class="secao-personalizacao">
    <h2><i class="fas fa-sliders-h"></i> Ajustes de Performance</h2>
    <p>Personalize sua experiência visual e tátil.</p>
    
    <div class="setting-item-flex">
        <div class="textos">
            <strong>Animações de Transição</strong>
            <span>Movimentos suaves entre telas e menus.</span>
        </div>
        <label class="switch">
            <input type="checkbox" id="pref-anim-interface" onchange="updatePref('pref-animInterface', this.checked)">
            <span class="slider"></span>
        </label>
    </div>

    <div class="setting-item-flex">
        <div class="textos">
            <strong>Efeitos de Fundo</strong>
            <span>Partículas, brilhos e elementos flutuantes.</span>
        </div>
        <label class="switch">
            <input type="checkbox" id="pref-anim-fundo" onchange="updatePref('pref-animFundo', this.checked)">
            <span class="slider"></span>
        </label>
    </div>

    <div class="setting-item-flex">
        <div class="textos">
            <strong>Efeito de Clique (Ripple)</strong>
            <span>Ondas visuais ao tocar em botões.</span>
        </div>
        <label class="switch">
            <input type="checkbox" id="pref-efeito-ripple" onchange="updatePref('pref-efeitoRipple', this.checked)">
            <span class="slider"></span>
        </label>
    </div>
</div>
        
       
       <div class="secao-personalizacao">
    <h2><i class="fas fa-font"></i> Estilo da Letra</h2>
    <p>Escolha o tipo de fonte que for mais agradável para sua leitura.</p>
    <div class="seletor-opcoes">
        <button type="button" class="opt-btn ripple" id="btn-font-sans" onclick="setFontFace('sans-serif', this)">
            <i class="fas fa-font"></i> Moderna
        </button>
        <button type="button" class="opt-btn ripple" id="btn-font-serif" onclick="setFontFace('serif', this)">
            <i class="fas fa-italic"></i> Clássica
        </button>
    </div>
</div>

<div class="secao-personalizacao">
    <h2><i class="fas fa-text-height"></i> Aparência do Texto</h2>
    <p>Ajuste o tamanho da leitura entre 50% e 200%.</p>
    
    <div class="range-container" style="margin-top: 1.5rem;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-weight: 800; font-size: 0.85rem;">
            <span>50%</span>
            <span id="valor-fonte-display" style="color: var(--cor-destaque); background: var(--cor-glass-fundo); padding: 2px 12px; border-radius: 20px; border: 1px solid var(--cor-glass-borda);">100%</span>
            <span>200%</span>
        </div>
        <input type="range" min="50" max="200" value="100" class="slider-range ripple" id="slider-fonte" oninput="ajustarFonteSlider(this.value)">
    </div>
</div>

<div class="secao-personalizacao">
    <h2><i class="fas fa-database"></i> Backup</h2>
    <p>Não perca suas configurações e frases. Exporte seus dados para segurança.</p>
    
    <button type="button" onclick="exportarConfig()" class="opt-btn ripple" style="margin-top: 10px; width: 100%; padding: 1rem; justify-content: center;">
        <i class="fas fa-file-export"></i> Exportar Dados
    </button>
    
    <button type="button" onclick="document.getElementById('fileInput').click()" class="opt-btn ripple" style="width: 100%; padding: 1rem; margin-top: 10px; border-style: dashed; justify-content: center;">
        <i class="fas fa-file-import"></i> Importar Dados
    </button>
    
    <input type="file" id="fileInput" style="display:none" accept=".json" onchange="importarConfig(event)">
</div>
        
        <div class="secao-personalizacao">
            <h2><i class="fas fa-undo-alt"></i> Gestão de Dados</h2>
            
            <p>Use esta opção para redefinir o aplicativo ao seu estado original de fábrica. <strong>Todas as suas frases criadas e personalizações de tema serão permanentemente apagadas.</strong></p>
            
            <button id="btn-restaurar-padroes" class="btn-restaurar-padroes ripple">
                <i class="fas fa-eraser"></i> Restaurar Padrões de Fábrica
            </button>
        </div>
        
    </div>
    
    <script>
    
    /**
 * Atualiza as preferências globais e aplica mudanças imediatas na UI
 */
window.updatePref = function(key, value) {
    // Salva no localStorage
    localStorage.setItem(key, value);
    
    const root = document.documentElement;
    
    // Aplica mudanças imediatas dependendo da chave
    switch(key) {
        case 'pref-animInterface':
            root.classList.toggle('no-anim-interface', value === false);
            break;
        case 'pref-animFundo':
            root.classList.toggle('no-anim-fundo', value === false);
            break;
        case 'pref-efeitoRipple':
            root.classList.toggle('no-ripple', value === false);
            break;
        case 'pref-vibracao':
            // Apenas para feedback visual de teste
            if(value && navigator.vibrate) navigator.vibrate(20);
            break;
    }

    // Feedback sonoro opcional ao mudar configuração
    if(window.playGlobalClick) window.playGlobalClick();
};

// --- FUNÇÕES GLOBAIS ---
function setFontFace(tipo, element) {
    const root = document.documentElement;
    const font = tipo === 'serif' ? '"Georgia", serif' : '"Nunito", sans-serif';
    root.style.setProperty('--familia-fonte', font);
    
    document.querySelectorAll('.seletor-opcoes .opt-btn').forEach(btn => btn.classList.remove('active'));
    if(element) element.classList.add('active');
    
    localStorage.setItem('appFontFace', tipo);
    if(window.playGlobalClick) window.playGlobalClick();
}

function ajustarFonteSlider(value) {
    document.documentElement.style.setProperty('--fonte-base', (value / 100) * 16 + 'px');
    const display = document.getElementById('valor-fonte-display');
    if(display) display.innerText = value + '%';
    localStorage.setItem('appFontePerc', value);
}

function exportarDados() {
    // Usando o exportarConfig global que já definimos no config-global.js
    if(typeof window.exportarConfig === 'function') {
        window.exportarConfig();
    } else {
        const dados = JSON.stringify(localStorage);
        const blob = new Blob([dados], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'backup-total-citacoes.json';
        a.click();
    }
}

function importarDados(input) {
    if (!input.files[0]) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const json = JSON.parse(e.target.result);
            // Modal de confirmação antes de sobrescrever tudo
            window.CustomModal.show({
                titulo: "Importar Backup?",
                mensagem: "Isso substituirá suas configurações e frases atuais pelos dados do arquivo. Deseja continuar?",
                tipo: "confirm",
                icone: "fa-file-import",
                aoConfirmar: () => {
                    Object.keys(json).forEach(key => localStorage.setItem(key, json[key]));
                    window.CustomModal.show({
                        titulo: "Sucesso!",
                        mensagem: "Backup restaurado. O aplicativo será reiniciado.",
                        icone: "fa-check-circle",
                        aoConfirmar: () => window.location.reload()
                    });
                }
            });
        } catch (err) { 
            window.CustomModal.show({ titulo: "Erro", mensagem: "Arquivo de backup inválido.", icone: "fa-times-circle" });
        }
    };
    reader.readAsText(input.files[0]);
}

// --- LÓGICA DE INICIALIZAÇÃO ---

document.addEventListener('DOMContentLoaded', () => {
    const KEY_VIBRACAO = 'prefVibracao';
    const KEY_SOM = 'prefSomClique';

    const dom = {
        toggleVibracao: document.getElementById('toggle-vibracao'),
        toggleSom: document.getElementById('toggle-som'),
        btnRestaurar: document.getElementById('btn-restaurar-padroes'),
        sliderFonte: document.getElementById('slider-fonte'),
        cardsInterativos: document.querySelectorAll('.ripple'),
    };

    /**
     * RESTAURAÇÃO TOTAL (Limpa TUDO com Modal Seguro)
     */
    function restoreDefaults() {
        window.CustomModal.show({
            titulo: "APAGAR TUDO?",
            mensagem: "Esta ação é irreversível! Você perderá favoritos, histórico, suas frases criadas e todas as personalizações.",
            tipo: "confirm",
            icone: "fa-exclamation-triangle",
            aoConfirmar: () => {
                localStorage.clear();
                if (navigator.vibrate) navigator.vibrate([50, 50, 50]);
                
                window.CustomModal.show({
                    titulo: "Restaurado",
                    mensagem: "O aplicativo foi resetado para o estado original.",
                    icone: "fa-trash-alt",
                    aoConfirmar: () => window.location.href = "index.html"
                });
            }
        });
    }

    // --- CONFIGURAÇÃO INICIAL E EVENTOS ---

    // 1. Carregar Fonte
    const fonteSalva = localStorage.getItem('appFontePerc') || '100';
    if (dom.sliderFonte) {
        dom.sliderFonte.value = fonteSalva;
        ajustarFonteSlider(fonteSalva);
    }

    // 2. Carregar Toggles
    if (dom.toggleVibracao) dom.toggleVibracao.checked = localStorage.getItem(KEY_VIBRACAO) !== 'false';
    if (dom.toggleSom) dom.toggleSom.checked = localStorage.getItem(KEY_SOM) !== 'false';

    // 3. Listeners
    if (dom.btnRestaurar) dom.btnRestaurar.addEventListener('click', restoreDefaults);

    if (dom.toggleVibracao) {
        dom.toggleVibracao.addEventListener('change', (e) => {
            localStorage.setItem(KEY_VIBRACAO, e.target.checked);
            if(e.target.checked && navigator.vibrate) navigator.vibrate(30);
        });
    }

    if (dom.toggleSom) {
        dom.toggleSom.addEventListener('change', (e) => {
            localStorage.setItem(KEY_SOM, e.target.checked);
            if(e.target.checked && window.playGlobalClick) window.playGlobalClick();
        });
    }

    // Ripple effect padrão
    dom.cardsInterativos.forEach(card => {
        card.addEventListener('click', () => {
            if(window.playGlobalClick) window.playGlobalClick();
        });
    });
});
</script>
</body>
</html>