
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Frase & Foto</title>
    
    <link href="assets/fontawesome/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/estilo-global.css">

<script src="assets/js/config-global.js"></script>
    
    <script>
    (function() {
        // Busca a preferência salva (padrão 100% se não existir)
        const fonteSalva = localStorage.getItem('appFontePerc') || '100';
        
        // Calcula o valor em pixels (16px * percentagem)
        const tamanhoCalculado = (fonteSalva / 100) * 16;
        
        // Aplica imediatamente ao root antes da página renderizar (evita o "pulo" visual)
        document.documentElement.style.setProperty('--fonte-base', tamanhoCalculado + 'px');
    })();
</script>
    <script>
        // --------------------------------
        // VARIÁVEIS DE CONFIGURAÇÃO E DADOS
        // --------------------------------
        const themeKey = 'appTheme';
        const corKey = 'appCorDestaque';
        const fundoKey = 'appCorFundo';
        const corTextoKey = 'appCorTexto';
        const corPadrao = '#e91e63'; 
        const fundoPadrao = '#eef2f5'; 
        const corTextoPadrao = '#1c274b'; 
        
        // Chaves de Feedback
        const KEY_VIBRACAO = 'prefVibracao';
        const KEY_SOM = 'prefSomClique';
        
        /** Aplica as configurações de tema e cor salvas no armazenamento local. */
        function loadSettings() {
            const savedTheme = localStorage.getItem(themeKey);
            const savedDestaque = localStorage.getItem(corKey);
            const savedFundo = localStorage.getItem(fundoKey);
            const savedTexto = localStorage.getItem(corTextoKey);
            
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            let isDarkMode = (savedTheme === 'dark') || (!savedTheme && prefersDark);
            
            if (document.body) {
                if (isDarkMode) {
                    document.body.classList.add('theme-escuro');
                } else {
                    document.body.classList.remove('theme-escuro');
                }
            }
            
            const finalFundo = savedFundo || (isDarkMode ? '#121212' : fundoPadrao);
            const finalTexto = savedTexto || (isDarkMode ? '#f0f0f0' : corTextoPadrao);

            document.documentElement.style.setProperty('--cor-destaque', savedDestaque || corPadrao);
            document.documentElement.style.setProperty('--cor-fundo-principal', finalFundo);
            document.documentElement.style.setProperty('--cor-texto-principal', finalTexto);
        }
        
        loadSettings();
    </script>
<style>
    /* -------------------------------- */
    /* 1. CONFIGURAÇÕES BASE & CORES    */
    /* -------------------------------- */
    @font-face {
        font-family: 'Nunito';
        src: url('assets/fontes/Nunito-VariableFont_wght.ttf') format('truetype');
        font-weight: 100 900;
    }

    :root {
        --cor-fundo-principal: #eef2f5; --cor-texto-principal: #1c274b; --cor-card-fundo: #ffffff; --cor-destaque: #e91e63;
        --cor-sombra: rgba(28, 39, 75, 0.15); --cor-glass-fundo: rgba(255, 255, 255, 0.25); --cor-glass-borda: rgba(255, 255, 255, 0.7);
        --cor-particula-1: var(--cor-destaque); --cor-particula-2: var(--cor-texto-principal); --fonte-base: 16px; --borda-raio: 1.5rem; --duracao-animacao: 0.5s;
    }
    .theme-escuro {
        --cor-fundo-principal: #121212; --cor-texto-principal: #f0f0f0; --cor-card-fundo: #1e1e1e; --cor-sombra: rgba(0, 0, 0, 0.5);
        --cor-glass-fundo: rgba(255, 255, 255, 0.05); --cor-glass-borda: rgba(255, 255, 255, 0.15); --cor-particula-1: var(--cor-destaque); 
        --cor-particula-2: var(--cor-texto-principal); 
    }

    * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
    html { font-size: var(--fonte-base); scroll-behavior: smooth; }
    body { font-family: 'Nunito', sans-serif; background-color: var(--cor-fundo-principal); color: var(--cor-texto-principal); min-height: 100vh; transition: background-color var(--duracao-animacao), color var(--duracao-animacao); padding-top: 5rem; padding-bottom: 6rem; }

    /* -------------------------------- */
    /* 2. FUNDO E ANIMAÇÕES ORIGINAIS   */
    /* -------------------------------- */
    .fundo-animado { position: fixed; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; z-index: -1; }
    .fundo-animado::before, .fundo-animado::after { content: ''; position: absolute; width: 15rem; height: 15rem; border-radius: 50%; opacity: 0.3; animation: flutuar 20s infinite ease-in-out; pointer-events: none; }
    .fundo-animado::before { background-color: var(--cor-particula-1); top: 10vh; left: 5vw; }
    .fundo-animado::after { background-color: var(--cor-particula-2); bottom: 15vh; right: 5vw; animation-delay: -10s; }
    @keyframes flutuar { 0%, 100% { transform: translate(0, 0) scale(1); } 50% { transform: translate(15vw, 15vh) scale(1.1); } }

    .ripple { position: relative; overflow: hidden; }
    .ripple-effect { position: absolute; border-radius: 50%; transform: scale(0); animation: ripple-anim 0.6s linear; background-color: rgba(255, 255, 255, 0.7); pointer-events: none; }
    @keyframes ripple-anim { to { transform: scale(4); opacity: 0; } }

    .fas, .fa { animation: pulse 3s infinite; display: inline-block; }
    @keyframes pulse { 0%,100%{transform:scale(1);} 50%{transform:scale(1.2);} }

    /* -------------------------------- */
    /* 3. CABEÇALHO (MANTIDO)           */
    /* -------------------------------- */
    .cabecalho-principal { display: flex; align-items: center; justify-content: space-between; position: fixed; top: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 95%; padding: 1rem 1.5rem; background-color: var(--cor-fundo-principal); box-shadow: 0 2px 10px var(--cor-sombra); z-index: 1000; border-radius: 1.5rem; margin-top: 1rem; }
    .cabecalho-principal h1 { font-size: 1.5rem; color: var(--cor-destaque); font-weight: 800; position: absolute; left: 50%; transform: translateX(-50%); }
    .btn-voltar { background: none; border: none; color: var(--cor-texto-principal); font-size: 1.5rem; cursor: pointer; padding: 0.5rem; border-radius: 50%; }

    /* -------------------------------- */
    /* 4. CANVAS E STICKY VIEW (AJUSTADO) */
    /* -------------------------------- */
    #visualizacao-container {
        position: sticky;
        top: 6.5rem;
        z-index: 900;
        width: 100%;
        max-width: 450px;
        margin: 0 auto 2rem auto;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        border-radius: 12px;
        overflow: hidden;
        background: #000;
        transition: 0.3s ease;
        border: 4px solid var(--cor-card-fundo);
    }
    #canvas-editor { display: block; width: 100%; height: auto; }

    /* Proporções Dinâmicas */
    #visualizacao-container.quadrado { aspect-ratio: 1 / 1; }
    #visualizacao-container.vertical { aspect-ratio: 4 / 5; }
    #visualizacao-container.story { aspect-ratio: 9 / 16; max-width: 320px; }
    #visualizacao-container.horizontal { aspect-ratio: 16 / 9; }

    /* -------------------------------- */
    /* 5. INTERFACE DO EDITOR (NOVO)    */
    /* -------------------------------- */
    .container { width: 100%; padding: 1.2rem; position: relative; z-index: 10; }

    .section-info {
        background: var(--cor-glass-fundo);
        backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
        border: 1px solid var(--cor-glass-borda);
        padding: 1.5rem; border-radius: var(--borda-raio);
        margin-bottom: 1.5rem; box-shadow: 0 4px 12px var(--cor-sombra);
    }

    .section-info h2 {
        font-size: 1.2rem; color: var(--cor-destaque);
        border-bottom: 3px solid var(--cor-destaque);
        padding-bottom: 0.5rem; margin-bottom: 1.5rem;
        display: flex; align-items: center; gap: 10px;
    }

    /* O Grid que estava faltando no CSS anterior */
    .controles-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
    }

    .input-group { margin-bottom: 15px; }
    .full-width { grid-column: span 2; }

    label { display: block; margin-bottom: 6px; font-weight: 700; font-size: 0.85rem; opacity: 0.9; }

    textarea, select, input[type="text"], input[type="color"] {
        width: 100%; padding: 12px; border-radius: 10px;
        border: 1px solid var(--cor-glass-borda);
        background-color: var(--cor-card-fundo);
        color: var(--cor-texto-principal);
        font-family: inherit;
    }

    /* Sliders Estilizados (ORIGINAL) */
    input[type="range"] {
        width: 100%; -webkit-appearance: none; height: 8px;
        border-radius: 5px; background: var(--cor-glass-borda);
        outline: none; margin: 10px 0;
    }
    input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none; width: 20px; height: 20px;
        border-radius: 50%; background: var(--cor-destaque); cursor: pointer;
        box-shadow: 0 0 5px rgba(0,0,0,0.2);
    }

    /* -------------------------------- */
    /* 6. BOTÕES (ORIGINAL + FIXO)      */
    /* -------------------------------- */
    .btn {
        padding: 12px 18px; border: none; border-radius: 12px;
        cursor: pointer; font-weight: 700; background-color: var(--cor-destaque);
        color: var(--cor-texto-principal); transition: 0.3s; display: flex;
        align-items: center; justify-content: center; gap: 8px;
    }
    
    .btn-acao-principal {
        position: fixed; bottom: 1.2rem; left: 5%; width: 90%;
        z-index: 1100; font-size: 1.1rem; padding: 15px;
        box-shadow: 0 10px 25px rgba(233, 30, 99, 0.4);
    }

/* -------------------------------- */
/* CONTAINER PRINCIPAL DO MODAL     */
/* -------------------------------- */
.modal {
    display: none; /* Controlado pelo JS (display: flex) */
    position: fixed;
    z-index: 9999;
    inset: 0;
    background: var(--cor-glass-fundo);
    backdrop-filter: blur(10px);
    align-items: center;
    justify-content: center;
    padding: 15px;
}

.modal-content {
    background: var(--cor-card-fundo);
    width: 100%;
    max-width: 500px;
    max-height: 90vh; /* Ocupa até 90% da tela vertical */
    padding: 20px;
    border-radius: 24px;
    display: flex;
    flex-direction: column;
    border: 1px solid var(--cor-glass-borda);
    box-shadow: 0 20px 40px rgba(0,0,0,0.4);
}

/* -------------------------------- */
/* ÁREA DE SCROLL (GRADE DE IMAGENS)*/
/* -------------------------------- */
#galeria-resultados, #galeria-predefinidas {
    flex: 1; /* Faz a galeria ocupar o espaço que sobrar */
    overflow-y: auto; 
    margin-top: 10px;
    padding-right: 5px; /* Espaço para a barra de scroll */
}

/* Estilização da barra de scroll interna */
#galeria-resultados::-webkit-scrollbar, 
#galeria-predefinidas::-webkit-scrollbar {
    width: 5px;
}
#galeria-resultados::-webkit-scrollbar-thumb, 
#galeria-predefinidas::-webkit-scrollbar-thumb {
    background: var(--cor-destaque);
    border-radius: 10px;
}

/* -------------------------------- */
/* A GRADE DE IMAGENS (DENTRO DO JS)*/
/* -------------------------------- */
/* Note que no JS criamos uma div de grid, este estilo garante o layout */
#galeria-resultados > div, 
#galeria-predefinidas > div {
    display: grid !important;
    grid-template-columns: repeat(3, 1fr) !important; /* 3 colunas padrão */
    gap: 12px !important;
    padding: 5px;
}

/* Responsividade: 4 colunas em telas levemente maiores */
@media (min-width: 450px) {
    #galeria-resultados > div, 
    #galeria-predefinidas > div {
        grid-template-columns: repeat(4, 1fr) !important;
    }
}

/* -------------------------------- */
/* ESTILO DAS IMAGENS (RESULTADOS)  */
/* -------------------------------- */
.resultado-imagem {
    width: 100% !important;
    aspect-ratio: 1 / 1 !important; /* Mantém quadrado perfeito */
    object-fit: cover !important; /* Não distorce */
    border-radius: 12px;
    cursor: pointer;
    border: 3px solid transparent;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    background: var(--cor-fundo-principal); /* Cor de fundo enquanto carrega */
}

.resultado-imagem:hover {
    border-color: var(--cor-destaque);
    transform: scale(1.05);
    z-index: 10;
}

.resultado-imagem:active {
    transform: scale(0.95);
}

/* -------------------------------- */
/* BOTÕES DE CATEGORIA (NAV)        */
/* -------------------------------- */
/* Para a barrinha de botões que criamos no JS */
#galeria-resultados div:first-child[style*="overflow-x: auto"] {
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE */
}
#galeria-resultados div:first-child[style*="overflow-x: auto"]::-webkit-scrollbar {
    display: none; /* Chrome/Safari */
}

/* -------------------------------- */
/* BOTÃO FECHAR                     */
/* -------------------------------- */
.fechar-modal {
    margin-top: 15px;
    padding: 14px;
    background: var(--cor-destaque);
    color: var(--cor-texto-principal);
    border: none;
    border-radius: 15px;
    font-weight: 700;
    cursor: pointer;
    transition: background 0.2s;
    flex-shrink: 0; /* Impede o botão de sumir */
}

.fechar-modal:hover {
    background: var(--cor-destaque);
}

.nav-categorias-modal {
    mask-image: linear-gradient(to right, black 85%, transparent 100%);
    -webkit-mask-image: linear-gradient(to right, black 85%, transparent 100%);
}
/* 1. CONTAINER DO PREVIEW FIXO (Estilo App) */
#visualizacao-container {
    position: sticky;
    top: 10px; /* Gruda no topo durante o scroll */
    z-index: 100;
    width: 95%;
    max-width: 400px;
    margin: 0 auto 1rem auto;
    background: #000;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    border: 2px solid var(--cor-glass-borda);
}

/* 2. BARRA DE NAVEGAÇÃO DE FERRAMENTAS (ESTILO INSHOT) */
.nav-ferramentas {
    display: flex;
    overflow-x: auto;
    white-space: nowrap;
    background: var(--cor-card-fundo);
    padding: 10px;
    position: sticky;
    top: 360px; /* Ajuste conforme a altura média do seu canvas */
    z-index: 99;
    gap: 10px;
    border-bottom: 1px solid var(--cor-glass-borda);
    margin: 0 -1.2rem 1.5rem -1.2rem; /* Sangria para encostar na borda */
}

.tab-link {
    display: flex;
    flex-direction: column;
    align-items: center;
    min-width: 70px;
    font-size: 0.7rem;
    color: var(--cor-texto-principal);
    opacity: 0.6;
    cursor: pointer;
    transition: 0.3s;
}

.tab-link i { font-size: 1.2rem; margin-bottom: 5px; }
.tab-link.active { opacity: 1; color: var(--cor-destaque); }

/* 3. AJUSTE NAS SEÇÕES PARA OCULTAR/EXIBIR */
.section-info {
    display: none; /* Escondemos todas por padrão */
    animation: fadeIn 0.3s ease;
}

.section-info.active {
    display: block; /* Só a aba selecionada aparece */
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* 4. GRID COMPACTO PARA MOBILE */
.controles-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
}
</style>

<body> 
    <div class="fundo-animado"></div>

    <header class="cabecalho-principal">
        <button onclick="window.location.href = 'index.html'" class="btn-voltar ripple" aria-label="Voltar">
            <i class="fas fa-arrow-left"></i>
        </button>
        <h1 id="header-titulo"><i class="fas fa-edit"></i> Frase & Foto</h1>
        <div style="width: 2.5rem; visibility: hidden;"></div> 
    </header>

    <main class="container">
        <div id="visualizacao-container" class="quadrado">
            <canvas id="canvas-editor"></canvas>
        </div>
        
        <nav class="nav-ferramentas">
            <div class="tab-link active" onclick="abrirAba(event, 'sec-formato')">
                <i class="fas fa-expand-arrows-alt"></i><span>Tamanho</span>
            </div>
            <div class="tab-link" onclick="abrirAba(event, 'sec-fundo')">
                <i class="fas fa-images"></i><span>Fundo</span>
            </div>
            <div class="tab-link" onclick="abrirAba(event, 'sec-ajustes')">
                <i class="fas fa-sliders-h"></i><span>Filtros</span>
            </div>
            <div class="tab-link" onclick="abrirAba(event, 'sec-texto')">
                <i class="fas fa-font"></i><span>Texto</span>
            </div>
        </nav>

        <section id="sec-formato" class="section-info active">
            <h2><i class="fas fa-expand-arrows-alt"></i> Formato do Post</h2>
            <div class="input-group">
                <label>Proporção da Tela:</label>
                <select id="seletor-resolucao">
                    <option value="1:1">Quadrado (1080x1080)</option>
                    <option value="4:5">Retrato (1080x1350)</option>
                    <option value="9:16">Stories (1080x1920)</option>
                    <option value="16:9">Paisagem (1920x1080)</option>
                </select>
            </div>
        </section>

        <section id="sec-fundo" class="section-info">
            <h2><i class="fas fa-images"></i> Escolher Fundo</h2>
            <div class="botoes-imagem" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;">
                <button id="btn-buscar-galeria" class="btn ripple"><i class="fas fa-upload"></i> Galeria</button>
                <input type="file" id="input-galeria" accept="image/*" style="display: none;">

                <button id="btn-buscar-online" class="btn ripple"><i class="fas fa-cloud-download-alt"></i> Online</button>
                
                <button id="btn-escolher-predefinida" class="btn ripple full-width" style="grid-column: span 2; background: var(--cor-destaque);">
                    <i class="fas fa-star"></i> Fundos do Predefinidos
                </button>
                <div class="input-group" style="margin-top: 15px; border-top: 1px solid #444; padding-top:10px;">
    <label><i class="fas fa-copyright"></i> Logo / Marca D'água</label>
    <input type="file" id="input-logo" accept="image/*">
</div>
<div class="input-group"><label>Tamanho Logo</label><input type="range" id="tamanho-logo" min="5" max="50" value="15"></div>
<div class="input-group"><label>Posição Logo</label>
    <select id="posicao-logo">
        <option value="br">Canto Inferior Direito</option>
        <option value="bl">Canto Inferior Esquerdo</option>
        <option value="tr">Canto Superior Direito</option>
        <option value="tl">Canto Superior Esquerdo</option>
        <option value="c">Centro</option>
    </select>
</div>
            </div>
            <button id="btn-espelhar" class="btn ripple" style="width: 100%; background: #444;">
                <i class="fas fa-arrows-alt-h"></i> Espelhar Imagem
            </button>
        </section>

        <section id="sec-ajustes" class="section-info">
            <h2><i class="fas fa-sliders-h"></i> Filtros</h2>
            <div class="controles-grid">
                <div class="input-group"><label>Brilho</label><input type="range" id="filtro-brilho" min="0" max="200" value="100"></div>
                <div class="input-group"><label>Contraste</label><input type="range" id="filtro-contraste" min="50" max="150" value="100"></div>
                <div class="input-group"><label>Blur (Desfoque)</label><input type="range" id="filtro-blur" min="0" max="20" value="0"></div>
                <div class="input-group"><label>Saturação</label><input type="range" id="filtro-saturacao" min="0" max="200" value="100"></div>
                <div class="input-group"><label>Sépia</label><input type="range" id="filtro-sepia" min="0" max="100" value="0"></div>
                <div class="input-group"><label>Matiz</label><input type="range" id="filtro-matiz" min="0" max="360" value="0"></div>
                <div class="input-group"><label>Escurecer Fundo</label><input type="range" id="filtro-overlay" min="0" max="90" value="30"></div>
            </div>
        </section>

        <section id="sec-texto" class="section-info">
            <h2><i class="fas fa-font"></i> Editar Texto</h2>
            <div class="input-group">
                <textarea id="input-frase" rows="3" placeholder="Digite sua frase aqui..."></textarea>
            </div>
            
            <div class="input-group" style="border: 1px dashed #ccc; padding: 10px; border-radius: 8px; margin-bottom: 15px;">
                <label style="cursor: pointer; width: 100%; display: block; text-align: center;">
                    <i class="fas fa-file-import"></i> Toque para usar Fonte .TTF
                    <input type="file" id="input-fonte-custom" accept=".ttf, .otf" style="display: none;">
                </label>
            </div>

            <div class="controles-grid">
                <div class="input-group" style="grid-column: span 2;">
                    <label>Fonte Padrão</label>
                    <select id="seletor-fonte">
                        <option value="Nunito">Nunito (Padrão)</option>
                        <option value="Impact">Impact</option>
                        <option value="Arial">Arial</option>
                        <option value="Courier New">Máquina de Escrever</option>
                        <option value="Georgia">Elegante</option>
                    </select>
                </div>
                <div class="input-group"><label>Tamanho</label><input type="range" id="tamanho-texto" min="20" max="300" value="80"></div>
                <div class="input-group"><label>Cor</label><input type="color" id="cor-texto" value="#ffffff"></div>
                <div class="input-group"><label>Alinhamento</label>
                    <select id="alinhamento-texto">
                        <option value="center">Centralizado</option>
                        <option value="left">Esquerda</option>
                        <option value="right">Direita</option>
                    </select>
                </div>
                <div class="input-group"><label>Espaçamento</label><input type="range" id="spacing-linha" min="8" max="25" value="12"></div>
                <div class="input-group"><label>Sombra</label><input type="range" id="texto-sombra-blur" min="0" max="50" value="10"></div>
                <div class="input-group"><label>Cor Sombra</label><input type="color" id="texto-sombra-cor" value="#000000"></div>
                <div class="input-group"><label>Borda</label><input type="range" id="texto-contorno-largura" min="0" max="15" value="0"></div>
                <div class="input-group"><label>Cor Borda</label><input type="color" id="texto-contorno-cor" value="#000000"></div>
            </div>
            <div class="input-group"><label>Cor do Fundo (Box)</label><input type="color" id="cor-fundo-texto" value="#000000"></div>
<div class="input-group"><label>Opacidade do Fundo</label><input type="range" id="opacidade-fundo-texto" min="0" max="100" value="0"></div>
<div class="input-group"><label>Padding (Gordura)</label><input type="range" id="padding-fundo-texto" min="0" max="50" value="10"></div>
        </section>

        <div style="padding: 40px 0 100px 0; text-align: center;"> 
            <button id="btn-download-imagem" class="btn btn-acao-principal ripple" style="font-size: 1.2rem; padding: 15px 30px;">
                <i class="fas fa-save"></i> SALVAR NA GALERIA
            </button>
            <button id="btn-reset" class="btn ripple" style="background: var(--cor-destaque); margin-top: 10px; width: 100%;">
    <i class="fas fa-undo"></i> Resetar Edição
</button>
        </div>
    </main>

    <div id="modal-busca-online" class="modal" style="display:none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:9999; justify-content:center; align-items:center;">
        <div class="modal-content" style="background:#fff; width:90%; max-height:80%; overflow-y:auto; padding:20px; border-radius:10px; position:relative;">
            <span class="fechar-modal" onclick="fecharModais()" style="position:absolute; top:10px; right:15px; font-size:30px; cursor:pointer; color:#333;">&times;</span>
            <h3 style="color:#333; margin-bottom:15px;">Imagens Online</h3>
            <div id="galeria-resultados" style="display:grid; grid-template-columns:repeat(3, 1fr); gap:8px;"></div>
        </div>
    </div>

    <div id="modal-predefinidas" class="modal" style="display:none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:9999; justify-content:center; align-items:center;">
        <div class="modal-content" style="background:#fff; width:90%; max-height:80%; overflow-y:auto; padding:20px; border-radius:10px; position:relative;">
            <span class="fechar-modal" onclick="fecharModais()" style="position:absolute; top:10px; right:15px; font-size:30px; cursor:pointer; color:#333;">&times;</span>
            <h3 style="color:#333; margin-bottom:15px;">Fundos do App</h3>
            <div id="galeria-predefinidas" style="display:grid; grid-template-columns:repeat(3, 1fr); gap:8px;"></div>
        </div>
    </div>
<script>


    // --- 1. CONFIGURAÇÕES E ESTADO ---
    const IMAGENS_ONLINE = {
        'Amor e Romântico': [
        'https://images.pexels.com/photos/1036329/pexels-photo-1036329.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/5699320/pexels-photo-5699320.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1031388/pexels-photo-1031388.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/259200/pexels-photo-259200.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/386009/pexels-photo-386009.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/978051/pexels-photo-978051.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1325143/pexels-photo-1325143.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/5699318/pexels-photo-5699318.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/3573887/pexels-photo-3573887.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/2448493/pexels-photo-2448493.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/2448494/pexels-photo-2448494.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/2448495/pexels-photo-2448495.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/2448496/pexels-photo-2448496.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/2448497/pexels-photo-2448497.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/2448498/pexels-photo-2448498.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/2448499/pexels-photo-2448499.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/2448500/pexels-photo-2448500.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/2448501/pexels-photo-2448501.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/2448502/pexels-photo-2448502.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/2448503/pexels-photo-2448503.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
    ],
    'Motivação e Sucesso': [
        'https://images.pexels.com/photos/1068523/pexels-photo-1068523.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1083863/pexels-photo-1083863.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/2361132/pexels-photo-2361132.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1587271/pexels-photo-1587271.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1097893/pexels-photo-1097893.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/4050315/pexels-photo-4050315.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/3770451/pexels-photo-3770451.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/2555557/pexels-photo-2555557.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/2555558/pexels-photo-2555558.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/2555559/pexels-photo-2555559.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/2555560/pexels-photo-2555560.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/2555561/pexels-photo-2555561.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/2555562/pexels-photo-2555562.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/2555563/pexels-photo-2555563.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/2555564/pexels-photo-2555564.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/2555565/pexels-photo-2555565.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/2555566/pexels-photo-2555566.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/2555567/pexels-photo-2555567.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/2555568/pexels-photo-2555568.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/2555569/pexels-photo-2555569.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
    ],
    'Fé e Espiritual': [
        'https://images.pexels.com/photos/110854/pexels-photo-110854.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/706851/pexels-photo-706851.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/731082/pexels-photo-731082.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/2531709/pexels-photo-2531709.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/2265882/pexels-photo-2265882.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1328001/pexels-photo-1328001.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1328002/pexels-photo-1328002.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1328003/pexels-photo-1328003.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1328004/pexels-photo-1328004.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1328005/pexels-photo-1328005.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1328006/pexels-photo-1328006.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1328007/pexels-photo-1328007.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1328008/pexels-photo-1328008.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1328009/pexels-photo-1328009.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1328010/pexels-photo-1328010.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1328011/pexels-photo-1328011.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1328012/pexels-photo-1328012.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1328013/pexels-photo-1328013.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1328014/pexels-photo-1328014.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1328015/pexels-photo-1328015.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
    ],
    'Natureza e Paisagens': [
        'https://images.pexels.com/photos/103123/pexels-photo-103123.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/33044/sunflower-sun-summer-yellow.jpg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/2085998/pexels-photo-2085998.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/235615/pexels-photo-235615.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/2559941/pexels-photo-2559941.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/3478810/pexels-photo-3478810.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/45853/pexels-photo-45853.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1587272/pexels-photo-1587272.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1587273/pexels-photo-1587273.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1587274/pexels-photo-1587274.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1587275/pexels-photo-1587275.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1587276/pexels-photo-1587276.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1587277/pexels-photo-1587277.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1587278/pexels-photo-1587278.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1587279/pexels-photo-1587279.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1587280/pexels-photo-1587280.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1587281/pexels-photo-1587281.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1587282/pexels-photo-1587282.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1587283/pexels-photo-1587283.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1587284/pexels-photo-1587284.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
    ],
    'Minimalista e Abstrato': [
        'https://images.pexels.com/photos/957024/pexels-photo-957024.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/2200543/pexels-photo-2200543.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/3282294/pexels-photo-3282294.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1765033/pexels-photo-1765033.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/4192667/pexels-photo-4192667.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1105766/pexels-photo-1105766.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1105767/pexels-photo-1105767.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1105768/pexels-photo-1105768.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1105769/pexels-photo-1105769.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1105770/pexels-photo-1105770.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1105771/pexels-photo-1105771.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1105772/pexels-photo-1105772.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1105773/pexels-photo-1105773.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1105774/pexels-photo-1105774.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1105775/pexels-photo-1105775.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1105776/pexels-photo-1105776.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1105777/pexels-photo-1105777.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1105778/pexels-photo-1105778.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1105779/pexels-photo-1105779.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1105780/pexels-photo-1105780.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
    ],
    'Cidades e Viagens': [
        'https://images.pexels.com/photos/169647/pexels-photo-169647.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/305829/pexels-photo-305829.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/417382/pexels-photo-417382.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/3225526/pexels-photo-3225526.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/3282294/pexels-photo-3282294.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/443356/pexels-photo-443356.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/443357/pexels-photo-443357.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/443358/pexels-photo-443358.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/443359/pexels-photo-443359.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/443360/pexels-photo-443360.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/443361/pexels-photo-443361.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/443362/pexels-photo-443362.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/443363/pexels-photo-443363.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/443364/pexels-photo-443364.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/443365/pexels-photo-443365.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/443366/pexels-photo-443366.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/443367/pexels-photo-443367.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/443368/pexels-photo-443368.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/443369/pexels-photo-443369.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/443370/pexels-photo-443370.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
    ],
    'Tecnologia e Futuro': [
        'https://images.pexels.com/photos/546819/pexels-photo-546819.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/208583/pexels-photo-208583.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/258293/pexels-photo-258293.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/735237/pexels-photo-735237.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1037993/pexels-photo-1037993.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1037994/pexels-photo-1037994.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1037995/pexels-photo-1037995.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1037996/pexels-photo-1037996.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1037997/pexels-photo-1037997.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1037998/pexels-photo-1037998.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1037999/pexels-photo-1037999.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1038000/pexels-photo-1038000.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1038001/pexels-photo-1038001.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1038002/pexels-photo-1038002.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1038003/pexels-photo-1038003.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1038004/pexels-photo-1038004.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1038005/pexels-photo-1038005.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1038006/pexels-photo-1038006.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1038007/pexels-photo-1038007.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1038008/pexels-photo-1038008.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
    ],
    'Comida e Gastronomia': [
        'https://images.pexels.com/photos/1640777/pexels-photo-1640777.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1565982/pexels-photo-1565982.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1640778/pexels-photo-1640778.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1640779/pexels-photo-1640779.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1640780/pexels-photo-1640780.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1640781/pexels-photo-1640781.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1640782/pexels-photo-1640782.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1640783/pexels-photo-1640783.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1640784/pexels-photo-1640784.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1640785/pexels-photo-1640785.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1640786/pexels-photo-1640786.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1640787/pexels-photo-1640787.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1640788/pexels-photo-1640788.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1640789/pexels-photo-1640789.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1640790/pexels-photo-1640790.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1640791/pexels-photo-1640791.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1640792/pexels-photo-1640792.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1640793/pexels-photo-1640793.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1640794/pexels-photo-1640794.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
        'https://images.pexels.com/photos/1640795/pexels-photo-1640795.jpeg?auto=compress&cs=tinysrgb&w=200&h=200',
    ],
    };
    const IMAGENS_LOCAIS = Array.from({length: 20}, (_, i) => `assets/imagem/fundo${i+1}.png`);

    let imagemFundo = null, imagemLogo = null;
    let espelhamento = 1, fonteCustomizada = null, dom = {};
    let textPos = { x: 0, y: 0 }, isDragging = false, startMouse = { x: 0, y: 0 };

    // --- 2. NAVEGAÇÃO E MODAIS ---
    function abrirAba(evt, id) {
        document.querySelectorAll(".section-info").forEach(s => s.classList.remove("active"));
        document.querySelectorAll(".tab-link").forEach(t => t.classList.remove("active"));
        const aba = document.getElementById(id);
        if(aba) { aba.classList.add("active"); evt.currentTarget.classList.add("active"); }
    }

    function fecharModais() {
        if(dom.modalOnline) dom.modalOnline.style.display = 'none';
        if(dom.modalLocais) dom.modalLocais.style.display = 'none';
    }

function renderizarGaleriaOnline() {
    dom.gridOnline.innerHTML = ''; // Limpa a galeria
    
    // Mudamos o layout do grid para aceitar títulos
    dom.gridOnline.style.display = 'block'; 

    for (let categoria in IMAGENS_ONLINE) {
        // Criar Título da Categoria
        const titulo = document.createElement('h4');
        titulo.innerText = categoria;
        titulo.style.cssText = "color: #333; margin: 20px 0 10px 0; border-left: 4px solid var(--cor-destaque); padding-left: 10px;";
        dom.gridOnline.appendChild(titulo);

        // Criar Container para as imagens daquela categoria
        const containerGrid = document.createElement('div');
        containerGrid.style.cssText = "display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;";

        IMAGENS_ONLONE[categoria].forEach(url => {
            const img = document.createElement('img');
            img.src = url;
            img.classList.add('ripple'); // Adiciona o efeito que você criou
            img.style.cssText = "width:100%; aspect-ratio:1/1; object-fit:cover; cursor:pointer; border-radius:8px; border: 1px solid #eee;";
            
            img.onclick = (e) => {
                applyRippleEffect(e); // Toca som e vibra
                carregarImagem(url);
            };
            
            containerGrid.appendChild(img);
        });

        dom.gridOnline.appendChild(containerGrid);
    }
    dom.modalOnline.style.display = 'flex';
}

    function renderizarGaleriaLocal() {
        dom.gridLocais.innerHTML = '';
        IMAGENS_LOCAIS.forEach(path => {
            const img = document.createElement('img');
            img.src = path; img.style.cssText = "width:100%; aspect-ratio:1/1; object-fit:cover; cursor:pointer; border-radius:8px;";
            img.onclick = () => carregarImagem(path);
            img.onerror = () => img.style.display = 'none';
            dom.gridLocais.appendChild(img);
        });
        dom.modalLocais.style.display = 'flex';
    }

    // --- 3. MOTOR GRÁFICO ---
    function carregarImagem(src) {
        const img = new Image();
        img.crossOrigin = "anonymous";
        img.onload = () => { imagemFundo = img; desenharCanvas(); fecharModais(); };
        img.src = src;
    }

    function getVal(id, fallback = 0) {
        const el = document.getElementById(id);
        return el ? (el.type === 'range' || el.type === 'number' ? parseFloat(el.value) : el.value) : fallback;
    }

    
    // --- MOTOR GRÁFICO COM AUTO-AJUSTE ---
    
    function desenharCanvas() {
    if (!dom.ctx) return;
    const { canvas, ctx } = dom;
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // 1. FUNDO
    if (imagemFundo) {
        ctx.save();
        ctx.filter = `brightness(${getVal('filtro-brilho', 100)}%) contrast(${getVal('filtro-contraste', 100)}%) blur(${getVal('filtro-blur', 0)}px) saturate(${getVal('filtro-saturacao', 100)}%) sepia(${getVal('filtro-sepia', 0)}%) hue-rotate(${getVal('filtro-matiz', 0)}deg)`;
        const scale = Math.max(canvas.width / imagemFundo.width, canvas.height / imagemFundo.height);
        const w = imagemFundo.width * scale;
        const h = imagemFundo.height * scale;
        ctx.translate(canvas.width / 2, canvas.height / 2);
        ctx.scale(espelhamento, 1);
        ctx.drawImage(imagemFundo, -w/2, -h/2, w, h);
        ctx.restore();

        const overlay = getVal('filtro-overlay', 30) / 100;
        ctx.fillStyle = `rgba(0,0,0,${overlay})`;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    // 2. TEXTO COM AUTO-AJUSTE
    const frase = document.getElementById('input-frase')?.value;
    if (frase) {
        ctx.save();
        
        let fontSize = parseInt(getVal('tamanho-texto', 80));
        const spacing = parseInt(getVal('spacing-letra', 0));
        const fontName = fonteCustomizada || getVal('seletor-fonte', 'Arial');
        const margemSeguranca = canvas.width * 0.15;
        const larguraMaximaTexto = canvas.width - (margemSeguranca * 2);
        const alturaMaximaTexto = canvas.height - (margemSeguranca * 2);

        let linhas;
        let alturaTotal;
        
        // Loop de auto-ajuste
        do {
            ctx.font = `bold ${fontSize}px "${fontName}"`;
            linhas = getLines(ctx, frase.trim(), larguraMaximaTexto, spacing);
            const lineHeight = fontSize * (getVal('spacing-linha', 12) / 10);
            alturaTotal = linhas.length * lineHeight;

            if (alturaTotal > alturaMaximaTexto && fontSize > 20) {
                fontSize -= 5;
            } else {
                break;
            }
        } while (fontSize > 20);

        const lineHeight = fontSize * (getVal('spacing-linha', 12) / 10);
        const align = getVal('alinhamento-texto', 'center');
        
        ctx.textAlign = 'left'; // Mudamos para 'left' e calculamos o X manualmente para precisão
        ctx.textBaseline = 'middle';

        // Posicionamento Global
        ctx.translate(canvas.width / 2 + textPos.x, canvas.height / 2 + textPos.y);
        ctx.rotate((getVal('texto-rotacao', 0) * Math.PI) / 180);

        // Início do Y (Centralizado verticalmente)
        let y = -((linhas.length - 1) * lineHeight) / 2;

        linhas.forEach(linha => {
            // Cálculo da largura exata da linha atual
            let larguraLinhaEfetiva = 0;
            for(let c of linha) { 
                larguraLinhaEfetiva += ctx.measureText(c).width + spacing; 
            }
            larguraLinhaEfetiva -= spacing; // Remove o excesso da última letra

            // Define o X inicial baseado no alinhamento selecionado
            let xBase = 0;
            if (align === 'center') xBase = -larguraLinhaEfetiva / 2;
            else if (align === 'right') xBase = (larguraMaximaTexto / 2) - larguraLinhaEfetiva;
            else xBase = -larguraMaximaTexto / 2;

            // Box de Fundo (Opcional)
            const opBox = getVal('opacidade-fundo-texto', 0) / 100;
            if (opBox > 0) {
                ctx.save();
                ctx.fillStyle = getVal('cor-fundo-texto', '#000000');
                ctx.globalAlpha = opBox;
                const p = getVal('padding-fundo-texto', 10);
                ctx.fillRect(xBase - p, y - fontSize/2 - p/2, larguraLinhaEfetiva + p*2, fontSize + p);
                ctx.restore();
            }

            // Estilo do Texto
            ctx.shadowColor = getVal('texto-sombra-cor', '#000000');
            ctx.shadowBlur = getVal('texto-sombra-blur', 10);
            ctx.fillStyle = getVal('cor-texto', '#ffffff');
            const borda = getVal('texto-contorno-largura', 0);

            // Desenho Letra por Letra
            let xL = xBase;
            for (let char of linha) {
                if(borda > 0) {
                    ctx.save();
                    ctx.strokeStyle = getVal('texto-contorno-cor', '#000');
                    ctx.lineWidth = borda;
                    ctx.lineJoin = "round";
                    ctx.strokeText(char, xL, y);
                    ctx.restore();
                }
                ctx.fillText(char, xL, y);
                xL += ctx.measureText(char).width + spacing;
            }
            y += lineHeight;
        });
        ctx.restore();
    }
    
    desenharLogo(ctx, canvas);
}

    // Função auxiliar para não poluir o código principal
    
    function desenharLogo(ctx, canvas) {
    const pos = getVal('posicao-logo', 'br');
    const m = 40; // margem

    // SE TIVER IMAGEM CARREGADA, DESENHA A IMAGEM
    if (imagemLogo) {
        const tam = getVal('tamanho-logo', 15) / 100;
        const wL = canvas.width * tam;
        const hL = wL * (imagemLogo.height / imagemLogo.width);
        let lx, ly;
        if (pos === 'tl') { lx = m; ly = m; }
        else if (pos === 'tr') { lx = canvas.width - wL - m; ly = m; }
        else if (pos === 'bl') { lx = m; ly = canvas.height - hL - m; }
        else if (pos === 'c')  { lx = (canvas.width-wL)/2; ly = (canvas.height-hL)/2; }
        else { lx = canvas.width - wL - m; ly = canvas.height - hL - m; }
        ctx.drawImage(imagemLogo, lx, ly, wL, hL);
    } 
    // SE NÃO TIVER IMAGEM, DESENHA O TEXTO DO AUTOR (AQUI ERA O ERRO)
    else {
        const autorParaDesenhar = document.getElementById('input-autor')?.value;
        if (autorParaDesenhar) {
            ctx.save();
            ctx.font = "35px Arial"; // Tamanho da marca d'água
            ctx.fillStyle = "rgba(255, 255, 255, 0.5)"; // Meio transparente
            ctx.textBaseline = 'middle';
            
            // Alinhamento inteligente
            ctx.textAlign = pos.includes('r') ? 'right' : (pos === 'c' ? 'center' : 'left');
            let tx = pos.includes('r') ? canvas.width - m : (pos === 'c' ? canvas.width/2 : m);
            let ty = pos.includes('b') ? canvas.height - m : (pos === 'c' ? canvas.height/2 : m + 35);

            ctx.fillText(autorParaDesenhar, tx, ty);
            ctx.restore();
        }
    }
}
// --- FUNÇÃO DE QUEBRA DE LINHA OTIMIZADA ---
function getLines(ctx, text, maxWidth, spacing) {
    // Normaliza o texto: remove espaços duplos e quebras de linha vazias no início/fim
    const paragraphs = text.trim().split('\n');
    let lines = [];

    paragraphs.forEach(p => {
        // Divide por espaços, mas filtra para evitar que espaços múltiplos virem "palavras vazias"
        let words = p.split(' ').filter(w => w !== "");
        let currentLine = '';

        for (let i = 0; i < words.length; i++) {
            let word = words[i];
            let testLine = currentLine + (currentLine === '' ? '' : ' ') + word;
            
            // Medição precisa letra por letra incluindo o espaçamento customizado
            let testWidth = 0;
            for(let char of testLine) { 
                testWidth += ctx.measureText(char).width + spacing; 
            }

            if (testWidth > maxWidth) {
                // Se a palavra sozinha é maior que o maxWidth, precisamos quebrar a palavra
                let wordWidth = 0;
                for(let char of word) { wordWidth += ctx.measureText(char).width + spacing; }
                
                if (wordWidth > maxWidth) {
                    if (currentLine !== '') lines.push(currentLine);
                    let subWord = '';
                    for (let char of word) {
                        let testSub = subWord + char;
                        let subWidth = 0;
                        for(let c of testSub) { subWidth += ctx.measureText(c).width + spacing; }
                        
                        if (subWidth > maxWidth) {
                            lines.push(subWord);
                            subWord = char;
                        } else {
                            subWord = testSub;
                        }
                    }
                    currentLine = subWord;
                } else {
                    // Se a palavra cabe, mas a linha não, pula a linha
                    if (currentLine !== '') lines.push(currentLine);
                    currentLine = word;
                }
            } else {
                currentLine = testLine;
            }
        }
        if (currentLine !== '') lines.push(currentLine);
    });

    return lines;
}
    
    // --- CONFIGURAÇÕES DE FEEDBACK ---


function playClickSound() {
    const isSomEnabled = localStorage.getItem(KEY_SOM) !== 'false'; 
    if (isSomEnabled) { 
        const clickSound = new Audio('assets/sound/click.mp3');
        clickSound.volume = 0.5;
        clickSound.play().catch(() => {});
    }
}

function triggerHapticFeedback(pattern = 20) {
    const isVibracaoEnabled = localStorage.getItem(KEY_VIBRACAO) !== 'false';
    if (navigator.vibrate && isVibracaoEnabled) {
        navigator.vibrate(pattern);
    }
}

function applyRippleEffect(e) {
    const target = e.currentTarget;
    triggerHapticFeedback(20);
    playClickSound(); 
    
    const rect = target.getBoundingClientRect();
    const oldRipple = target.querySelector('.ripple-effect');
    if (oldRipple) oldRipple.remove();

    const size = Math.max(rect.width, rect.height);
    const clientX = (e.clientX !== undefined) ? e.clientX : (e.touches && e.touches[0] ? e.touches[0].clientX : undefined);
    const clientY = (e.clientY !== undefined) ? e.clientY : (e.touches && e.touches[0] ? e.touches[0].clientY : undefined);
    
    if (clientX === undefined || clientY === undefined) return;

    const x = clientX - rect.left - size / 2;
    const y = clientY - rect.top - size / 2;

    const newRipple = document.createElement('span');
    newRipple.classList.add('ripple-effect');
    newRipple.style.width = newRipple.style.height = size + 'px';
    newRipple.style.left = x + 'px';
    newRipple.style.top = y + 'px';
    
    target.appendChild(newRipple);
    newRipple.addEventListener('animationend', () => newRipple.remove());
}

// --- ATIVAÇÃO NOS BOTÕES ---
document.addEventListener('DOMContentLoaded', () => {
    // Aplica o efeito Ripple em todos os elementos que têm a classe .ripple
    const botoesRipple = document.querySelectorAll('.ripple');
    botoesRipple.forEach(btn => {
        btn.addEventListener('click', applyRippleEffect);
        // Suporte para toque em dispositivos móveis
        btn.addEventListener('touchstart', applyRippleEffect, {passive: true});
    });
});

    // --- 4. INICIALIZAÇÃO ---
    function mapearDom() {
        dom = {
            canvas: document.getElementById('canvas-editor'),
            ctx: document.getElementById('canvas-editor').getContext('2d'),
            container: document.getElementById('visualizacao-container'),
            seletorRes: document.getElementById('seletor-resolucao'),
            btnOnline: document.getElementById('btn-buscar-online'),
            btnPredefinidas: document.getElementById('btn-escolher-predefinida'),
            gridOnline: document.getElementById('galeria-resultados'),
            gridLocais: document.getElementById('galeria-predefinidas'),
            modalOnline: document.getElementById('modal-busca-online'),
            modalLocais: document.getElementById('modal-predefinidas'),
            inputs: document.querySelectorAll('input, select, textarea')
        };
    }
    
    

    document.addEventListener('DOMContentLoaded', () => {
        mapearDom();
        dom.seletorRes.onchange = (e) => {
            const val = e.target.value; const [w, h] = val.split(':').map(Number);
            dom.container.className = val === "1:1" ? "quadrado" : val === "4:5" ? "vertical" : val === "9:16" ? "story" : "horizontal";
            dom.canvas.width = 1080; dom.canvas.height = 1080 * (h / w);
            textPos = { x: 0, y: 0 }; desenharCanvas();
        };

        dom.canvas.onmousedown = (e) => {
            isDragging = true; const rect = dom.canvas.getBoundingClientRect();
            startMouse = { x: e.clientX - rect.left, y: e.clientY - rect.top };
        };
        window.onmousemove = (e) => {
            if (!isDragging) return;
            const rect = dom.canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left, mouseY = e.clientY - rect.top;
            const factor = dom.canvas.width / rect.width;
            textPos.x += (mouseX - startMouse.x) * factor; textPos.y += (mouseY - startMouse.y) * factor;
            startMouse = { x: mouseX, y: mouseY }; desenharCanvas();
        };
        window.onmouseup = () => isDragging = false;

        dom.btnOnline.onclick = renderizarGaleriaOnline;
        dom.btnPredefinidas.onclick = renderizarGaleriaLocal;
        document.getElementById('btn-espelhar').onclick = () => { espelhamento *= -1; desenharCanvas(); };
        document.getElementById('input-galeria').onchange = (e) => {
            const reader = new FileReader(); reader.onload = (ev) => carregarImagem(ev.target.result);
            reader.readAsDataURL(e.target.files[0]);
        };
      
      document.getElementById('input-logo').onchange = (e) => {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = (ev) => {
            const img = new Image();
            img.onload = () => {
                imagemLogo = img;
                desenharCanvas(); // Atualiza o canvas assim que a logo carregar
            };
            img.src = ev.target.result;
        };
        reader.readAsDataURL(file);
    }
};
        document.getElementById('input-fonte-custom').onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    const f = new FontFace('FonteUser', ev.target.result);
                    f.load().then(loaded => { document.fonts.add(loaded); fonteCustomizada = 'FonteUser'; desenharCanvas(); });
                };
                reader.readAsArrayBuffer(file);
            }
        };
        document.getElementById('btn-download-imagem').onclick = () => {
            const link = document.createElement('a'); link.download = `post-${Date.now()}.png`;
            link.href = dom.canvas.toDataURL('image/png', 1.0); link.click();
        };

        dom.inputs.forEach(i => i.addEventListener('input', desenharCanvas));
        dom.canvas.width = 1080; dom.canvas.height = 1080;
        desenharCanvas();
        
        // 1. Função de Reset
document.getElementById('btn-reset').onclick = () => {
    // Reseta filtros para o padrão
    document.getElementById('filtro-brilho').value = 100;
    document.getElementById('filtro-contraste').value = 100;
    document.getElementById('filtro-blur').value = 0;
    document.getElementById('filtro-saturacao').value = 100;
    document.getElementById('filtro-sepia').value = 0;
    document.getElementById('filtro-matiz').value = 0;
    document.getElementById('filtro-overlay').value = 30;
    
    // Reseta posição do texto e espelhamento
    textPos = { x: 0, y: 0 };
    espelhamento = 1;
    
    desenharCanvas();
};

// 2. Feedback de Cursor no Canvas (CSS via JS)
dom.canvas.style.cursor = "grab";
dom.canvas.addEventListener('mousedown', () => dom.canvas.style.cursor = "grabbing");
dom.canvas.addEventListener('mouseup', () => dom.canvas.style.cursor = "grab");

// 3. Melhoria no Download (Garantir Qualidade Máxima)
document.getElementById('btn-download-imagem').onclick = () => {
    // Força o redesenho uma última vez antes de exportar
    desenharCanvas();
    const link = document.createElement('a');
    link.download = `meu-post-${Date.now()}.png`;
    // Usamos 1.0 para qualidade máxima do PNG
    link.href = dom.canvas.toDataURL('image/png', 1.0);
    link.click();
};
    });
</script>

<script>
    
    document.addEventListener('DOMContentLoaded', () => {
    const dadosBrutos = localStorage.getItem('dados_edicao_simples');
    if (dadosBrutos) {
        try {
            const dados = JSON.parse(dadosBrutos);

            // Injeta a Frase
            const campoFrase = document.getElementById('input-frase');
            if (campoFrase) {
                campoFrase.value = dados.textoFrase;
                campoFrase.dispatchEvent(new Event('input'));
            }

            // Injeta o Autor (Certifique-se que o ID no HTML é 'input-autor')
            const campoAutor = document.getElementById('input-autor');
            if (campoAutor) {
                campoAutor.value = dados.textoAutor;
                campoAutor.dispatchEvent(new Event('input'));
            }

            localStorage.removeItem('dados_edicao_simples');

            // Força o desenho manual após os inputs serem preenchidos
            setTimeout(() => {
                if (typeof desenharCanvas === 'function') desenharCanvas();
            }, 600);
        } catch (e) { console.error(e); }
    }
});
    
</script>
 
</body>

</html>